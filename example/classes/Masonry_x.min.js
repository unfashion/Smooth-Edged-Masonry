export default class Masonry_x{constructor(t){this.breakPoints=t.breakPoints?t.breakPoints:[0,400,1e3],this.lineHeights=t.lineHeights?t.lineHeights:[100,200,300],this.gaps=t.gaps?t.gaps:["3px","3px","4px"],this.mainContainer=t.mainContainer?document.querySelector(t.mainContainer):document.querySelector(".unf-masonry"),this.itemContainer=t.itemContainer?t.itemContainer:".picture",this.masonryItems=this.mainContainer.querySelectorAll(this.itemContainer),this.zoom=t.zoom?t.zoom:void 0,this.adaptDefine(),this.preBuild(),document.addEventListener("DOMContentLoaded",(()=>{this.build(),this.loadImg(),window.onload=()=>{window.addEventListener("resize",(()=>{this.adaptDefine(),this.onResize()}))}}))}adaptDefine(){this.breakPoints.forEach(((t,i)=>{this.mainContainer.clientWidth>=t&&(this.lineHeight=this.lineHeights[i],this.gap=this.gaps[i])}))}onResize(){this.mainContainerNewWidth=this.mainContainer.clientWidth,this.mainContainerWidth!=this.mainContainerNewWidth&&(this.build(),this.setMainContainerWidth(),this.masonryItems.forEach(((t,i)=>{this.item=t,this.loadingImg=i,this.item=this.masonryItems[this.loadingImg],this.img=this.item.querySelector("img"),this.place()})))}preBuild(){this.masonryItems.forEach((t=>{t.removeAttribute("style"),t.style.cssText="display: none; opacity: 0;",t.querySelector("a").style.cssText="\n            width: 100%; height: 100%; display: block; line-height: 0px; overflow: hidden;"}))}build(){this.loadingImg=0,this.mainContainer.style.margin=-this.gap+"px",this.stringsElementsCollection=[],this.currentStringElements=[],this.stringsWidth=[],this.oneStringWidth=0,this.elementPositionX=0,this.elementPositionY=0,this.setMainContainerWidth(),this.setMainContainerStyles()}loadImg(){this.item=this.masonryItems[this.loadingImg];let t=this.item.querySelector("img");this.zoom&&(t.addEventListener("mouseover",(()=>{t.style.transform="scale(1.2)",t.style.transition=`all ${this.zoom} cubic-bezier(0.19, 0.15, 0.38, 1.14)`})),t.addEventListener("mouseout",(()=>t.style.transform=""))),t.complete?this.afterLoad():t.onload=()=>this.afterLoad()}afterLoad(){this.place(),this.loadingImg<this.masonryItems.length-1&&(this.loadingImg=this.loadingImg+1,this.loadImg())}place(){let t=this.item.querySelector("img");t.removeAttribute("style"),this.item.style.cssText=`\n        box-sizing: border-box;\n        position: absolute;\n        padding-top: ${this.gap};\n        padding-left: ${this.gap};\n        height: ${this.lineHeight+"px"};\n        width: ${t.naturalWidth*this.lineHeight/t.naturalHeight+"px"}`,t.style.cssText="width: 100%; height: 100%; object-fit: cover;",this.item.style.paddingTop=this.gap,this.item.style.paddingLeft=this.gap,this.elementPositionX+this.item.clientWidth/2>this.mainContainer.clientWidth&&(this.stringsWidth.push(this.oneStringWidth),this.stringsElementsCollection.push(this.currentStringElements),this.currentStringElements=[],this.elementPositionY+=this.lineHeight,this.elementPositionX=0,this.mainContainer.style.height=this.elementPositionY+this.lineHeight+"px"),this.currentStringElements.push(this.item),this.oneStringWidth=this.elementPositionX+this.item.clientWidth,this.item.style.left=this.elementPositionX+"px",this.item.style.top=this.elementPositionY+"px",this.elementPositionX+=this.item.clientWidth,this.loadingImg==this.masonryItems.length-1&&(this.stringsWidth.push(this.oneStringWidth),this.stringsElementsCollection.push(this.currentStringElements),this.spreadLast())}spreadLast(){this.stringsWidth[this.stringsWidth.length-2];let t=this.stringsWidth[this.stringsWidth.length-1],i=this.stringsElementsCollection[this.stringsElementsCollection.length-1],e=this.stringsElementsCollection[this.stringsElementsCollection.length-2];if(t<this.mainContainerWidth/2&&e.length>1){Math.round((this.masonryItems.length-i.length)/(this.stringsWidth.length-1))>1&&(this.elementPositionX=0,this.elementPositionY=e[0].offsetTop,e=[...e,...i],e.forEach((t=>{t.style.left=this.elementPositionX+"px",t.style.top=this.elementPositionY+"px",this.elementPositionX+=t.clientWidth})),this.stringsElementsCollection.pop(),this.stringsWidth.pop(),this.stringsElementsCollection.pop(),this.stringsElementsCollection.push(e),this.stringsWidth[this.stringsWidth.length-1]=this.elementPositionX)}this.mainContainer.style.height=this.elementPositionY+this.lineHeight+"px",this.smoothEdge()}setMainContainerHeight(){this.mainContainer.style.height=Math.max(...this.columnsY)+"px"}setMainContainerWidth(){this.mainContainer.style.width=`calc(100% + ${this.gap})`,this.mainContainer.style.marginTop=`-${this.gap}`,this.mainContainer.style.marginLeft=`-${this.gap}`,this.mainContainerWidth=this.mainContainer.clientWidth}setMainContainerStyles(){this.mainContainer.style.cssText="\n        display: block; position: relative; height: 100%; overflow: hidden;"}smoothEdge(){for(let t=0;t<this.stringsElementsCollection.length;t++){let i=0;for(let e=0;e<this.stringsElementsCollection[t].length;e++){let s=this.stringsElementsCollection[t][e];this.setMainContainerWidth();let n=s.clientWidth*this.mainContainerWidth/this.stringsWidth[t];s.style.width=n+"px",s.style.left=i+"px",i+=n}}}}